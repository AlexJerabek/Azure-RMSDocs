---
title: How to - process email messages using MIP SDK
description: This article will help you understand the scenario of how to use MIP SDK file API to process .msg and .rpmsg files.
author: msmbaldwin
ms.service: information-protection
ms.topic: conceptual
ms.date: 04/08/2020
ms.author: mbaldwin
---

# File API email message file processing

MIP SDK supports decryption and encryption for email messages. Both .msg files, generated by Outlook or Exchange, as well as .rpmsg files are supported by the SDK although in slightly different ways which we will cover in this scenario.

Some of the popular use cases for this scenario are:

- Decrypt messages for eDiscovery
- Decrypt mail and attachments for DLP inspection
- Publish protected messages directly from line-of-business applications
- Decrypt, modify, and reprotect messages in transit

## File API operations for .msg files

File API supports protection operations for .msg files and in manner identical to any other file type, except that the SDK needs the application to enable MSG feature flag. 

> [!IMPORTANT]
> Labeling operations for .msg files are not currently supported.

As discussed previously, instantiation of `mip::FileEngine` requires a setting object, `mip::FileEngineSettings`. `mip::FileEngineSettings` can be used to pass parameters for custom settings the application needs to set for a particular instance. CustomSettings property of the FileEngineSettings is used to set the flag for `enable_msg_file_type` to enable processing of .msg files.

The .msg file protection operations pseudocode may look like:

- Set `enable_msg_file_type` flag in `mip::FileEngineSettings` and add the `mip::FileEngine` to `mip::FileProfile`.
- Use Protection API to List protection templates available to the user.
- Construct `mip::FileHandler` that points to the file to be protected.
- Select a template to protect and set protection to the file using `mip::FileHandler`'s `SetProtection` method.

Refer Protection API [Quickstart: List templates](quick-protection-list-templates-cpp.md) for information on how to list protection templates.

## File API operations for .rpmsg files

MIP SDK does not support MIME-compliant (commonly EML) messages. Rather, the SDK exposes an inspection function capable of decrypting the embedded **message.rpmsg** file and presenting a set of byte streams as output. It's up to the SDK consumer to extract the message.rpmsg file and pass it to the API. Variations of this file name exist for Office Message Encryption scenarios and the API will also accept message_v2, v3, or v4 files.

Commonly, mail gateway and data loss prevention (DLP) services handle MIME compliant messages while email is in transit. When mail is protected, the contents of the message are stored in an attachment, *message.rpmsg*. This attachments contains the encrypted email body and any attachments that were part of the original message. The *rpmsg* file is the attached to a plaintext wrapper email and then sent to the mail service. Once that message leaves the Exchange or Exchange Online boundary, it's in the MIME-compliant format so that it can be sent to its destination.

In most cases, the DLP partner needs to be able to get the attachments and plaintext bytes from the message to inspect and evaluate against DLP policies. The inspect API takes the message.rpmsg as input and returns byte streams as output. These byte streams contain the plaintext bytes of the message as well as the attachments. Itâ€™s up to the application developer to handle these streams and to do something useful with them (inspect, recursively decrypt, etc.).

The `Inspect` API is implemented through a class `mip::FileInspector` which exposes operations for inspecting supported file types. `mip::MsgInspector` which extends `mip::FileInspector`, exposes decryption operations specific to rpmsg file format. MIP SDK does not support any publishing scenarios for *message.rpmsg* files.

`mip::MsgInspector` class exposes below members:

```cpp
public const std::vector<uint8_t>& GetBody()
public BodyType GetBodyType() const
public BodyType GetBodyType() const
public InspectorType GetInspectorType() const
public std::shared_ptr<Stream> GetFileStream() const
```

For additional details refer to [API reference](./reference/mip-sdk-reference.md).

## Next Steps

- Review the [File API - Process email .msg files (C++) quickstart](quick-email-msg-cpp.md)
- Review the [File API - Process email .msg files (C#) quickstart](quick-email-msg-csharp.md)